# ‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ —à—Ç—Ä–∞—Ñ–æ–≤ –∑–∞ –∫–≤–µ—Å—Ç—ã

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–∏–Ω—Ü–∏–ø:
**–ó–∞ –ö–ê–ñ–î–´–ô –≤—ã–±—Ä–∞–Ω–Ω—ã–π, –Ω–æ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –∫–≤–µ—Å—Ç –∏–≥—Ä–æ–∫ —Ç–µ—Ä—è–µ—Ç –æ–ø—ã—Ç**

### –ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —à—Ç—Ä–∞—Ñ:
- –ö–≤–µ—Å—Ç –≤–∑—è—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (—Å—Ç–∞—Ç—É—Å `active`)
- –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏—Å—Ç–µ–∫ (`expiresAt < now`)
- –ö–≤–µ—Å—Ç –ù–ï –≤—ã–ø–æ–ª–Ω–µ–Ω (—Å—Ç–∞—Ç—É—Å –Ω–µ `completed`)

### –†–∞–∑–º–µ—Ä —à—Ç—Ä–∞—Ñ–∞:
```
–®—Ç—Ä–∞—Ñ = –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –∫–≤–µ—Å—Ç
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- Easy –∫–≤–µ—Å—Ç (60 XP) ‚Üí —à—Ç—Ä–∞—Ñ **-60 XP**
- Medium –∫–≤–µ—Å—Ç (100 XP) ‚Üí —à—Ç—Ä–∞—Ñ **-100 XP**
- Hard –∫–≤–µ—Å—Ç (150 XP) ‚Üí —à—Ç—Ä–∞—Ñ **-150 XP**
- Epic –∫–≤–µ—Å—Ç (300 XP) ‚Üí —à—Ç—Ä–∞—Ñ **-300 XP**

## –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è

### –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–≤–µ—Å—Ç—ã:
–ï—Å–ª–∏ –≤–∑—è–ª–∏ 10 –∫–≤–µ—Å—Ç–æ–≤ –∏ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ:
```
10 easy –∫–≤–µ—Å—Ç–æ–≤ √ó 60 XP = -600 XP
10 medium –∫–≤–µ—Å—Ç–æ–≤ √ó 100 XP = -1000 XP
10 hard –∫–≤–µ—Å—Ç–æ–≤ √ó 150 XP = -1500 XP
```

### –ü–æ—Ç–µ—Ä—è —É—Ä–æ–≤–Ω–µ–π:
```
–£—Ä–æ–≤–µ–Ω—å 5 (10,000 XP)
–í–∑—è–ª–∏ 10 hard –∫–≤–µ—Å—Ç–æ–≤
–ù–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ
–®—Ç—Ä–∞—Ñ: -1500 XP
–ò—Ç–æ–≥–æ: 8,500 XP ‚Üí –£—Ä–æ–≤–µ–Ω—å 4

–£—Ä–æ–≤–µ–Ω—å 10 (40,000 XP)
–í–∑—è–ª–∏ 20 epic –∫–≤–µ—Å—Ç–æ–≤
–ù–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ
–®—Ç—Ä–∞—Ñ: -6000 XP
–ò—Ç–æ–≥–æ: 34,000 XP ‚Üí –£—Ä–æ–≤–µ–Ω—å 9
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§—É–Ω–∫—Ü–∏—è: `penalizeExpiredQuests(userId)`

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ –∫–≤–µ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≥–¥–µ:
   - `status = 'active'` (–≤—ã–±—Ä–∞–Ω, –Ω–æ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω)
   - `expiresAt < now` (—Å—Ä–æ–∫ –∏—Å—Ç–µ–∫)
2. –°—É–º–º–∏—Ä—É–µ—Ç –Ω–∞–≥—Ä–∞–¥—ã –≤—Å–µ—Ö —Ç–∞–∫–∏—Ö –∫–≤–µ—Å—Ç–æ–≤
3. –í—ã—á–∏—Ç–∞–µ—Ç —ç—Ç—É —Å—É–º–º—É –∏–∑ –æ–ø—ã—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å
5. –£–¥–∞–ª—è–µ—Ç –∏—Å—Ç–µ–∫—à–∏–µ –∫–≤–µ—Å—Ç—ã

**–ö–æ–¥:**
```javascript
// –ù–∞—Ö–æ–¥–∏–º –∏—Å—Ç–µ–∫—à–∏–µ –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∫–≤–µ—Å—Ç—ã
const expiredQuests = await UserQuest.findAll({
  where: {
    userId,
    expiresAt: { [Op.lt]: now },
    status: 'active' // –í—ã–±—Ä–∞–Ω–Ω—ã–µ, –Ω–æ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ
  }
});

// –°—É–º–º–∏—Ä—É–µ–º —à—Ç—Ä–∞—Ñ—ã
let totalXpLost = 0;
for (const quest of expiredQuests) {
  totalXpLost += quest.quest.reward.xp;
}

// –°–Ω–∏–º–∞–µ–º –æ–ø—ã—Ç
stats.experience = Math.max(0, stats.experience - totalXpLost);
stats.level = calculateLevel(stats.experience);
await stats.save();
```

### –ö–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `getUserQuests(userId)`
- –¢–æ –µ—Å—Ç—å –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–≤–µ—Å—Ç–æ–≤
- –®—Ç—Ä–∞—Ñ—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –î–û –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –∫–≤–µ—Å—Ç–æ–≤

## –ó–∞—â–∏—Ç–∞

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–ø—ã—Ç:
```javascript
stats.experience = Math.max(0, stats.experience - totalXpLost);
```
–û–ø—ã—Ç –Ω–µ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º (–º–∏–Ω–∏–º—É–º 0)

### –£–¥–∞–ª–µ–Ω–∏–µ –∫–≤–µ—Å—Ç–æ–≤:
–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —à—Ç—Ä–∞—Ñ–∞ –∏—Å—Ç–µ–∫—à–∏–µ –∫–≤–µ—Å—Ç—ã —É–¥–∞–ª—è—é—Ç—Å—è, —á—Ç–æ–±—ã –∏–≥—Ä–æ–∫ –º–æ–≥ –≤—ã–±—Ä–∞—Ç—å –Ω–æ–≤—ã–µ

## –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤

### ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û:
- –ë—Ä–∞—Ç—å 2-3 easy –∫–≤–µ—Å—Ç–∞ –≤ –¥–µ–Ω—å
- –ë—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ –∫–≤–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç–æ—á–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—à—å
- –ù–µ –±—Ä–∞—Ç—å –∫–≤–µ—Å—Ç—ã, –µ—Å–ª–∏ –Ω–µ —É–≤–µ—Ä–µ–Ω

### ‚ö†Ô∏è –†–ò–°–ö–û–í–ê–ù–ù–û:
- –ë—Ä–∞—Ç—å 5+ –∫–≤–µ—Å—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ë—Ä–∞—Ç—å hard/epic –∫–≤–µ—Å—Ç—ã "–Ω–∞ —É–¥–∞—á—É"
- –ë—Ä–∞—Ç—å –∫–≤–µ—Å—Ç—ã –≤ –∫–æ–Ω—Ü–µ –¥–Ω—è (–º–∞–ª–æ –≤—Ä–µ–º–µ–Ω–∏)

### ‚ùå –û–ü–ê–°–ù–û:
- –ë—Ä–∞—Ç—å 10+ –∫–≤–µ—Å—Ç–æ–≤
- –ë—Ä–∞—Ç—å –≤—Å–µ available –∫–≤–µ—Å—Ç—ã
- –ë—Ä–∞—Ç—å –∫–≤–µ—Å—Ç—ã –∏ –Ω–µ –∏–≥—Ä–∞—Ç—å

## –ü—Ä–∏–º–µ—Ä—ã –∏–∑ –∂–∏–∑–Ω–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û—Å—Ç–æ—Ä–æ–∂–Ω—ã–π –∏–≥—Ä–æ–∫
```
–£—Ä–æ–≤–µ–Ω—å: 5 (10,500 XP)
–î–µ–π—Å—Ç–≤–∏–µ: –í–∑—è–ª 3 easy –∫–≤–µ—Å—Ç–∞ (–ø–æ 60 XP)
–†–µ–∑—É–ª—å—Ç–∞—Ç: –í—ã–ø–æ–ª–Ω–∏–ª –≤—Å–µ 3
–ù–∞–≥—Ä–∞–¥–∞: +180 XP
–ò—Ç–æ–≥–æ: 10,680 XP (–£—Ä–æ–≤–µ–Ω—å 5)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ñ–∞–¥–Ω—ã–π –∏–≥—Ä–æ–∫
```
–£—Ä–æ–≤–µ–Ω—å: 5 (10,500 XP)
–î–µ–π—Å—Ç–≤–∏–µ: –í–∑—è–ª 10 medium –∫–≤–µ—Å—Ç–æ–≤ (–ø–æ 100 XP)
–†–µ–∑—É–ª—å—Ç–∞—Ç: –í—ã–ø–æ–ª–Ω–∏–ª 2, –Ω–µ —É—Å–ø–µ–ª –Ω–∞ 8
–ù–∞–≥—Ä–∞–¥–∞: +200 XP (–∑–∞ 2 –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö)
–®—Ç—Ä–∞—Ñ: -800 XP (–∑–∞ 8 –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö)
–ò—Ç–æ–≥–æ: 9,900 XP (–£—Ä–æ–≤–µ–Ω—å 4) ‚Üê –ü–û–ù–ò–ñ–ï–ù–ò–ï!
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û—á–µ–Ω—å –∂–∞–¥–Ω—ã–π –∏–≥—Ä–æ–∫
```
–£—Ä–æ–≤–µ–Ω—å: 10 (45,000 XP)
–î–µ–π—Å—Ç–≤–∏–µ: –í–∑—è–ª 20 epic –∫–≤–µ—Å—Ç–æ–≤ (–ø–æ 300 XP)
–†–µ–∑—É–ª—å—Ç–∞—Ç: –ù–µ –≤—ã–ø–æ–ª–Ω–∏–ª –Ω–∏ –æ–¥–Ω–æ–≥–æ
–®—Ç—Ä–∞—Ñ: -6000 XP
–ò—Ç–æ–≥–æ: 39,000 XP (–£—Ä–æ–≤–µ–Ω—å 9) ‚Üê –ü–û–ù–ò–ñ–ï–ù–ò–ï –ù–ê 1 –£–†–û–í–ï–ù–¨!
```

## –í—ã–≤–æ–¥

**–°–∏—Å—Ç–µ–º–∞ —à—Ç—Ä–∞—Ñ–æ–≤ —Å–æ–∑–¥–∞–µ—Ç —Ä–∏—Å–∫ –∏ —Ç—Ä–µ–±—É–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–≥–æ –º—ã—à–ª–µ–Ω–∏—è:**
- –ù–µ–ª—å–∑—è –ø—Ä–æ—Å—Ç–æ –±—Ä–∞—Ç—å –≤—Å–µ –∫–≤–µ—Å—Ç—ã
- –ù—É–∂–Ω–æ –æ—Ü–µ–Ω–∏–≤–∞—Ç—å —Å–≤–æ–∏ —Å–∏–ª—ã
- –í–∞–∂–Ω–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä–æ–≤–æ–µ –≤—Ä–µ–º—è
- –õ—É—á—à–µ –≤–∑—è—Ç—å –º–µ–Ω—å—à–µ, –Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ

**–ù–∞–≥—Ä–∞–¥–∞ –∑–∞ —É—Å–ø–µ—Ö = –®—Ç—Ä–∞—Ñ –∑–∞ –ø—Ä–æ–≤–∞–ª**

–≠—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –∫–≤–µ—Å—Ç–æ–≤ –±–æ–ª–µ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–π –∏ –∑–Ω–∞—á–∏–º–æ–π! üéÆ
