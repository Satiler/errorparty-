# üîß –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê: –°–∏—Å—Ç–µ–º–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –º–∞—Ç—á–∏ –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ Share Code

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ Share Code –º–∞—Ç—á–∞ —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å 50 —Å–æ—Å–µ–¥–Ω–∏—Ö –º–∞—Ç—á–µ–π, –Ω–æ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ:
- –û—Å—Ç–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ 1 –º–∞—Ç—á (—Å–∞–º –≤–≤–µ–¥—ë–Ω–Ω—ã–π –∫–æ–¥)
- –ù–µ—Ç –¥—Ä—É–≥–∏—Ö –º–∞—Ç—á–µ–π –≤ –ë–î
- –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ **DevTools** (F12)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Console**
3. –í–≤–µ–¥–∏—Ç–µ Share Code –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–∏–≤—è–∑–∞—Ç—å"
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏:

```javascript
üîê Token from localStorage: Found/NOT FOUND
üì§ Sending POST to /api/cs2/auth/match-token
‚úÖ Response: {...}
‚ùå Link match token error: ...
```

**–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ `NOT FOUND`:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω!

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Network tab

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Network** tab –≤ DevTools
2. –í–≤–µ–¥–∏—Ç–µ Share Code
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ POST –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/cs2/auth/match-token`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - **Status:** 200 ‚úÖ –∏–ª–∏ 401/403/500 ‚ùå
   - **Headers:** Authorization: Bearer {...}
   - **Response:** `{"success": true/false}`

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞

```bash
docker logs errorparty_backend --tail 100 | grep -i "linkMatchToken\|Starting full match\|HTTP 412"
```

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**

‚úÖ **–£—Å–ø–µ—Ö:**
```
üîó Match Token linked for user 5: CSGO-FYZJH-...
üîÑ Starting full match history sync using token as anchor...
üì• Fetching match 1/50... (from CSGO-FYZJH-...)
‚úÖ Match 1: CSGO-xxxxx...
```

‚ùå **–û—à–∏–±–∫–∞ 412:**
```
‚ùå HTTP 412: Authentication token is EXPIRED or INVALID
   ‚Üí –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω: https://help.steampowered.com/wizard/...
```

‚ùå **–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
```
Access token required
Invalid token
```

## üõ†Ô∏è –†–µ—à–µ–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤–æ—à–ª–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Steam API —Ç–æ–∫–µ–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π (HTTP 412)

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π CS2 Auth Token:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ: https://help.steampowered.com/wizard/HelpWithGameIssue/?appid=730&issueid=128
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞
2. –°—ã–≥—Ä–∞–π—Ç–µ **—Ö–æ—Ç—è –±—ã 1 –º–∞—Ç—á** –Ω–∞ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
3. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ —Å–∞–π—Ç
4. –ü—Ä–∏–≤—è–∂–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω (—Ä–∞–∑–¥–µ–ª CS2 –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Üí –ü—Ä–∏–≤—è–∑–∞—Ç—å —Ç–æ–∫–µ–Ω)
5. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø—Ä–∏–≤—è–∂–∏—Ç–µ Share Code

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–æ

Steam API –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º. –°–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ñ–æ–Ω–µ.

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
- –ù–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
- –ü–æ–¥–æ–∂–¥–∏—Ç–µ 2-5 –º–∏–Ω—É—Ç
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π

**–õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:**
```
‚ùå Match history sync error: ...
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –ü—Ä–æ—Ñ–∏–ª—å Steam **–æ—Ç–∫—Ä—ã—Ç** (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
2. Auth Token –¥–æ —Å–∏—Ö –ø–æ—Ä **–≤–∞–ª–∏–¥–Ω—ã–π** (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ—Ç—É—Ö–Ω—É—Ç)
3. –ú–∞—Ç—á –±—ã–ª –Ω–∞ **—Å–æ—Ä–µ–≤–Ω–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ** (–Ω–µ —Å–∫—Ä–∏–º, –Ω–µ –¥–∞–Ω–∂–∞)

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤ –ë–î

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
docker exec errorparty_postgres psql -U errorparty -d errorparty \
  -c "SELECT id, cs2_auth_token, cs2_match_token FROM users WHERE id = 5;"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞—Ç—á–∏
docker exec errorparty_postgres psql -U errorparty -d errorparty \
  -c "SELECT COUNT(*), source FROM cs2_matches WHERE user_id = 5 GROUP BY source;"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–º–æ
docker exec errorparty_postgres psql -U errorparty -d errorparty \
  -c "SELECT COUNT(*), status FROM cs2_demos GROUP BY status;"
```

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ API –Ω–∞–ø—Ä—è–º—É—é

```bash
# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –º–∞—Ç—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -X GET http://localhost:3001/api/cs2/matches/76561198306468078

# –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å: –º–∞—Å—Å–∏–≤ –º–∞—Ç—á–µ–π —Å source='share_code'
```

## ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å

1. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç Share Code
2. ‚úÖ POST –Ω–∞ `/api/cs2/auth/match-token`
3. ‚úÖ –ë—ç–∫–µ–Ω–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–¥ –≤ `user.cs2_match_token`
4. ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ñ–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
5. ‚úÖ Steam API –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è 50 —Ä–∞–∑ (–º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ)
6. ‚úÖ –ú–∞—Ç—á–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ –ë–î —Å `source='share_code'`
7. ‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

## üìã –ß–µ–∫–ª–∏—Å—Ç

- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω (–∫–æ–Ω—Å–æ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `Token from localStorage: Found`)
- [ ] –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è (Network tab –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 200 status)
- [ ] –ë—ç–∫–µ–Ω–¥ –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å (–ª–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç `linkMatchToken`)
- [ ] Steam API –æ—Ç–≤–µ—á–∞–µ—Ç (–ª–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç `Fetching match 1/50`)
- [ ] –ú–∞—Ç—á–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è (–ë–î –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç N –º–∞—Ç—á–µ–π —Å `source='share_code'`)
- [ ] –§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–∞—Ç—á–∏)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 23.11.2025
