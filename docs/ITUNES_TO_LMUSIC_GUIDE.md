# üéµ –ò–º–ø–æ—Ä—Ç –º—É–∑—ã–∫–∏: iTunes ‚Üí Lmusic.kz

## üìã –°—Ç—Ä–∞—Ç–µ–≥–∏—è

**–ö–æ–Ω—Ü–µ–ø—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–µ–º iTunes RSS –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç—Ä–µ–∫–∞—Ö, –∑–∞—Ç–µ–º –∏—â–µ–º –ø–æ–ª–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –Ω–∞ Lmusic.kz

### –ü–æ—á–µ–º—É —Ç–∞–∫–∞—è —Å—Ö–µ–º–∞?

‚úÖ **iTunes RSS:**
- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π, –ø—É–±–ª–∏—á–Ω—ã–π API (–±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
- ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —á–∞—Ä—Ç—ã –ø–æ –≤—Å–µ–º —Å—Ç—Ä–∞–Ω–∞–º
- ‚úÖ –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç—Ä–µ–∫–∞—Ö/–∞–ª—å–±–æ–º–∞—Ö
- ‚ùå –ù–ï–¢ –ø–æ–ª–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤ (—Ç–æ–ª—å–∫–æ 30-—Å–µ–∫—É–Ω–¥–Ω—ã–µ preview)

‚úÖ **Lmusic.kz:**
- ‚úÖ –ü–æ–ª–Ω—ã–µ —Ç—Ä–µ–∫–∏ —Å –ø—Ä—è–º—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–µ URL

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1Ô∏è‚É£ –ß–µ—Ä–µ–∑ CLI (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞)

```bash
# –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
cd backend
node import-itunes-to-lmusic.js
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç:**
1. –ó–∞–≥—Ä—É–∑–∏—Ç —Ç–æ–ø-50 —Ç—Ä–µ–∫–æ–≤ –∏–∑ –°–®–ê, –†–æ—Å—Å–∏–∏, –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏–∏, –ì–µ—Ä–º–∞–Ω–∏–∏
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç—Ä–µ–∫–∞ –Ω–∞–π–¥–µ—Ç –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é –Ω–∞ Lmusic.kz
3. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
4. –ó–∞–≥—Ä—É–∑–∏—Ç —Ç–æ–ø-15 –∞–ª—å–±–æ–º–æ–≤ –∏–∑ –°–®–ê –∏ –†–æ—Å—Å–∏–∏
5. –°–æ–∑–¥–∞—Å—Ç/–æ–±–Ω–æ–≤–∏—Ç –ø–ª–µ–π–ª–∏—Å—Ç "–ú–∏—Ä–æ–≤—ã–µ —Ö–∏—Ç—ã 2025"

---

### 2Ô∏è‚É£ –ß–µ—Ä–µ–∑ Docker

```powershell
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker cp "d:\–ú–û–ô –°–ê–ô–¢\backend\import-itunes-to-lmusic.js" errorparty_backend:/app/

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç
docker exec errorparty_backend node /app/import-itunes-to-lmusic.js
```

---

### 3Ô∏è‚É£ –ß–µ—Ä–µ–∑ API (Admin Panel)

#### –ò–º–ø–æ—Ä—Ç –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤

```bash
POST /api/admin/music/itunes-to-lmusic/import-tracks
Content-Type: application/json
Authorization: Bearer YOUR_ADMIN_TOKEN

{
  "countries": ["us", "ru", "gb", "de"],
  "limitPerCountry": 50
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "imported": 120,
  "skipped": 30,
  "notFound": 10,
  "message": "–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ 120 —Ç—Ä–µ–∫–æ–≤ –∏–∑ iTunes —á–µ—Ä–µ–∑ Lmusic.kz"
}
```

---

#### –ò–º–ø–æ—Ä—Ç –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∞–ª—å–±–æ–º–æ–≤

```bash
POST /api/admin/music/itunes-to-lmusic/import-albums
Content-Type: application/json
Authorization: Bearer YOUR_ADMIN_TOKEN

{
  "countries": ["us", "ru"],
  "limitPerCountry": 20
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "albums": 18,
  "tracks": 156,
  "message": "–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ 18 –∞–ª—å–±–æ–º–æ–≤ (156 —Ç—Ä–µ–∫–æ–≤)"
}
```

---

#### –û–±–Ω–æ–≤–∏—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç "–ú–∏—Ä–æ–≤—ã–µ —Ö–∏—Ç—ã"

```bash
POST /api/admin/music/itunes-to-lmusic/update-playlist
Content-Type: application/json
Authorization: Bearer YOUR_ADMIN_TOKEN

{}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "playlist": {
    "id": 5,
    "title": "–ú–∏—Ä–æ–≤—ã–µ —Ö–∏—Ç—ã 2025",
    "trackCount": 100
  },
  "message": "–ü–ª–µ–π–ª–∏—Å—Ç \"–ú–∏—Ä–æ–≤—ã–µ —Ö–∏—Ç—ã\" –æ–±–Ω–æ–≤–ª–µ–Ω"
}
```

---

## üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã (iTunes RSS)

| –ö–æ–¥ | –°—Ç—Ä–∞–Ω–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|--------|----------|
| `us` | –°–®–ê | –ì–ª–∞–≤–Ω—ã–π –º–∏—Ä–æ–≤–æ–π —á–∞—Ä—Ç |
| `ru` | –†–æ—Å—Å–∏—è | –†—É—Å—Å–∫–æ—è–∑—ã—á–Ω–∞—è –º—É–∑—ã–∫–∞ |
| `gb` | –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è | –ï–≤—Ä–æ–ø–µ–π—Å–∫–∏–µ —Ö–∏—Ç—ã |
| `de` | –ì–µ—Ä–º–∞–Ω–∏—è | –ù–µ–º–µ—Ü–∫–∏–µ –∏ –µ–≤—Ä–æ–ø–µ–π—Å–∫–∏–µ —Ö–∏—Ç—ã |
| `fr` | –§—Ä–∞–Ω—Ü–∏—è | –§—Ä–∞–Ω—Ü—É–∑—Å–∫–∞—è –º—É–∑—ã–∫–∞ |
| `jp` | –Ø–ø–æ–Ω–∏—è | –ê–∑–∏–∞—Ç—Å–∫–∞—è –º—É–∑—ã–∫–∞ |
| `br` | –ë—Ä–∞–∑–∏–ª–∏—è | –õ–∞—Ç–∏–Ω–æ–∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∞—è –º—É–∑—ã–∫–∞ |
| `au` | –ê–≤—Å—Ç—Ä–∞–ª–∏—è | –û–∫–µ–∞–Ω–∏—è |
| `ca` | –ö–∞–Ω–∞–¥–∞ | –°–µ–≤–µ—Ä–Ω–∞—è –ê–º–µ—Ä–∏–∫–∞ |
| `mx` | –ú–µ–∫—Å–∏–∫–∞ | –ò—Å–ø–∞–Ω–æ—è–∑—ã—á–Ω–∞—è –º—É–∑—ã–∫–∞ |

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –∫–æ–¥

### –ò–º–ø–æ—Ä—Ç —Ç–æ–ª—å–∫–æ —Ç–æ–ø-—Ç—Ä–µ–∫–æ–≤

```javascript
const { importTopTracks } = require('./backend/import-itunes-to-lmusic');

// –ò–º–ø–æ—Ä—Ç –∏–∑ 3 —Å—Ç—Ä–∞–Ω, –ø–æ 30 —Ç—Ä–µ–∫–æ–≤
await importTopTracks(['us', 'ru', 'gb'], 30);
```

### –ò–º–ø–æ—Ä—Ç —Ç–æ–ª—å–∫–æ –∞–ª—å–±–æ–º–æ–≤

```javascript
const { importTopAlbums } = require('./backend/import-itunes-to-lmusic');

// –ò–º–ø–æ—Ä—Ç –∏–∑ 2 —Å—Ç—Ä–∞–Ω, –ø–æ 10 –∞–ª—å–±–æ–º–æ–≤
await importTopAlbums(['us', 'ru'], 10);
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞

```javascript
const { updateGlobalHitsPlaylist } = require('./backend/import-itunes-to-lmusic');

const playlist = await updateGlobalHitsPlaylist();
console.log(`–ü–ª–µ–π–ª–∏—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω: ${playlist.title}`);
```

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–º–ø–æ—Ä—Ç–∞

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–º–ø–æ—Ä—Ç–∞ –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
üéµ ===== –ò–ú–ü–û–†–¢ –ü–û–ü–£–õ–Ø–†–ù–´–• –¢–†–ï–ö–û–í =====

üìç –°—Ç—Ä–∞–Ω—ã: us, ru, gb
üìä –õ–∏–º–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω—É: 50

==================================================
üìç –°–¢–†–ê–ù–ê: US
==================================================

üåç –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ø-50 –∏–∑ US (iTunes RSS)...
‚úÖ –ü–æ–ª—É—á–µ–Ω–æ 50 —Ç—Ä–µ–∫–æ–≤ –∏–∑ iTunes

[1/50] #1 The Weeknd - Blinding Lights
  üìÇ –ñ–∞–Ω—Ä: Pop
  üîç –ü–æ–∏—Å–∫: "the weeknd blinding lights"
  ‚úÖ –ù–∞–π–¥–µ–Ω–æ: The Weeknd - Blinding Lights
  üíæ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω (ID: 1523)

...

üìä –ò—Ç–æ–≥–∏ –ø–æ US:
  ‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: 42
  ‚è≠Ô∏è  –£–∂–µ –±—ã–ª–∏: 5
  ‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–æ: 3

==================================================
üìä –û–ë–©–ò–ï –ò–¢–û–ì–ò
==================================================
‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: 120
‚è≠Ô∏è  –£–∂–µ –±—ã–ª–∏ –≤ –±–∞–∑–µ: 15
‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–æ: 15
üìà –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: 90%
```

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞

1. **–ë–µ—Å–ø–ª–∞—Ç–Ω–æ:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç API –∫–ª—é—á–µ–π –∏–ª–∏ –ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫
2. **–ê–∫—Ç—É–∞–ª—å–Ω–æ:** iTunes –æ–±–Ω–æ–≤–ª—è–µ—Ç —á–∞—Ä—Ç—ã –µ–∂–µ–¥–Ω–µ–≤–Ω–æ
3. **–õ–µ–≥–∞–ª—å–Ω–æ:** –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑ iTunes, –º—É–∑—ã–∫—É –±–µ—Ä–µ–º —Å Lmusic.kz
4. **–°—Ç–∞–±–∏–ª—å–Ω–æ:** Lmusic.kz –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ MP3
5. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ:** –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ cron –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

## ‚öôÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (Cron)

–î–æ–±–∞–≤—å—Ç–µ –≤ `backend/src/server.js`:

```javascript
const cron = require('node-cron');
const { importTopTracks, updateGlobalHitsPlaylist } = require('./import-itunes-to-lmusic');

// –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00 —É—Ç—Ä–∞
cron.schedule('0 3 * * *', async () => {
  console.log('üéµ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –º—É–∑—ã–∫–∏...');
  
  try {
    // –ò–º–ø–æ—Ä—Ç –Ω–æ–≤—ã—Ö —Ç—Ä–µ–∫–æ–≤
    await importTopTracks(['us', 'ru', 'gb'], 30);
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞
    await updateGlobalHitsPlaylist();
    
    console.log('‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω');
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ–∏–º–ø–æ—Ä—Ç–∞:', error);
  }
});
```

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "Cannot find module"

```bash
cd backend
npm install axios
```

### –û—à–∏–±–∫–∞: "ECONNREFUSED" (iTunes)

iTunes RSS –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–∑–∂–µ.

### –û—à–∏–±–∫–∞: "No tracks found" (Lmusic)

–¢—Ä–µ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ Lmusic.kz. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è ~5-10% —Ç—Ä–µ–∫–æ–≤.

### –û—à–∏–±–∫–∞: "Database connection failed"

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—É—â–µ–Ω–∞:

```bash
docker ps | Select-String "postgres"
```

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **–ó–∞–¥–µ—Ä–∂–∫–∏:** –°–∫—Ä–∏–ø—Ç –¥–µ–ª–∞–µ—Ç –ø–∞—É–∑—ã –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (500ms), —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å —Å–µ—Ä–≤–µ—Ä—ã
- **–î—É–±–ª–∏–∫–∞—Ç—ã:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è, –µ—Å–ª–∏ —Ç—Ä–µ–∫ —É–∂–µ –≤ –±–∞–∑–µ
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö:** –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç—Ä–µ–∫–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è popularityScore –∏ chartPosition
- **–ü–ª–µ–π–ª–∏—Å—Ç:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- **–°–∫—Ä–∏–ø—Ç:** `backend/import-itunes-to-lmusic.js`
- **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä:** `backend/src/modules/music/admin-music.controller.js`
- **–†–æ—É—Ç—ã:** `backend/src/modules/music/admin-music.routes.js`
- **iTunes API:** `backend/src/services/lastfm.service.js`
- **Lmusic API:** `backend/src/modules/music/lmusic-kz.service.js`

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏–º–ø–æ—Ä—Ç–∞ –ø–æ–ø—É–ª—è—Ä–Ω–æ–π –º—É–∑—ã–∫–∏! üéâ
