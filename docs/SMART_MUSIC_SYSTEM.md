# üéµ –£–º–Ω–∞—è –º—É–∑—ã–∫–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø–ª–µ–π–ª–∏—Å—Ç–∞–º–∏

## –û–±–∑–æ—Ä

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º—É–∑—ã–∫–∞–ª—å–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Å:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–æ–≤ –∏–∑ Lmusic.kz
- ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ç—Ä–µ–∫–æ–≤ (–∏–∑–±–µ–∂–∞–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
- ‚úÖ –ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–Ω–æ–≤–∏–Ω–∫–∏, —á–∞—Ä—Ç—ã, –∫–ª–∞—Å—Å–∏–∫–∞)
- ‚úÖ –£–º–Ω—ã–µ –ø–ª–µ–π–ª–∏—Å—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏

```
backend/src/modules/music/
‚îú‚îÄ‚îÄ music-auto-sync.service.js     # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç —Ç—Ä–µ–∫–æ–≤
‚îú‚îÄ‚îÄ user-preferences.service.js    # –ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ smart-playlists.service.js     # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–º–Ω—ã—Ö –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ music-scheduler.js             # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á (cron)
‚îî‚îÄ‚îÄ music.routes.js                # API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
```

### –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```
PostgreSQL Tables:
‚îú‚îÄ‚îÄ Tracks                 # –¢—Ä–µ–∫–∏ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
‚îú‚îÄ‚îÄ AutoPlaylists          # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç—ã
‚îú‚îÄ‚îÄ UserPreferences        # –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ ListeningHistory       # –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ TrackLikes             # –õ–∞–π–∫–∏ —Ç—Ä–µ–∫–æ–≤
```

## API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –£–º–Ω—ã–µ –ø–ª–µ–π–ª–∏—Å—Ç—ã

#### `GET /api/music/smart-playlists/:type`
–ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–µ–π–ª–∏—Å—Ç (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

**–¢–∏–ø—ã –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤:**
- `daily` - –ü–ª–µ–π–ª–∏—Å—Ç –¥–Ω—è (30 —Ç—Ä–µ–∫–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π)
- `premiere` - –ü—Ä–µ–º—å–µ—Ä—ã (20 –Ω–æ–≤—ã—Ö —Ä–µ–ª–∏–∑–æ–≤)
- `stash` - –¢–∞–π–Ω–∏–∫ (25 —Å–∫—Ä—ã—Ç—ã—Ö –∂–µ–º—á—É–∂–∏–Ω)
- `charts` - –ß–∞—Ä—Ç—ã (50 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤)

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  https://localhost/api/music/smart-playlists/daily
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "playlist": {
    "id": 1,
    "userId": 1,
    "type": "daily",
    "name": "–ü–ª–µ–π–ª–∏—Å—Ç –¥–Ω—è",
    "description": "–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–±–æ—Ä–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π",
    "trackIds": [1, 5, 12, 45, ...],
    "generatedAt": "2025-11-30T10:00:00Z",
    "expiresAt": "2025-12-01T10:00:00Z"
  },
  "tracks": [
    {
      "id": 1,
      "title": "–¢—Ä–µ–∫ 1",
      "artist": "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å",
      "genre": "Pop",
      ...
    }
  ]
}
```

#### `POST /api/music/smart-playlists/refresh`
–û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø–ª–µ–π–ª–∏—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "playlists": [
    {
      "type": "daily",
      "name": "–ü–ª–µ–π–ª–∏—Å—Ç –¥–Ω—è",
      "trackCount": 30,
      "generatedAt": "2025-11-30T10:00:00Z"
    }
  ]
}
```

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º—É–∑—ã–∫–∏

#### `POST /api/music/sync/run`
–ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç —Ç—Ä–µ–∫–æ–≤ (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "taskName": "full-sync",  // full-sync | import-charts | import-new-releases
  "options": {
    "limit": 50,
    "chartsLimit": 50,
    "newReleasesLimit": 30
  }
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "task": "full-sync",
  "results": {
    "charts": {
      "imported": 45,
      "skipped": 5,
      "errors": 0
    },
    "newReleases": {
      "imported": 28,
      "skipped": 2,
      "errors": 0
    }
  }
}
```

#### `GET /api/music/sync/stats`
–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

**–û—Ç–≤–µ—Ç:**
```json
{
  "total": 500,
  "bySource": {
    "external": 450,
    "local": 50
  },
  "categories": {
    "newReleases": 120,
    "charts": 200
  },
  "timestamp": "2025-11-30T12:00:00Z"
}
```

#### `GET /api/music/scheduler/status`
–°—Ç–∞—Ç—É—Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∑–∞–¥–∞—á

**–û—Ç–≤–µ—Ç:**
```json
{
  "running": true,
  "jobs": [
    {
      "name": "–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤",
      "schedule": "0 0 * * *",
      "running": true
    },
    {
      "name": "–ò–º–ø–æ—Ä—Ç –Ω–æ–≤–∏–Ω–æ–∫ –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤",
      "schedule": "0 */6 * * *",
      "running": true
    }
  ]
}
```

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏

### –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ

| –ó–∞–¥–∞—á–∞ | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-----------|----------|
| **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤** | `0 0 * * *` | –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00 |
| **–ò–º–ø–æ—Ä—Ç –Ω–æ–≤–∏–Ω–æ–∫** | `0 */6 * * *` | –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤ |
| **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Ä—Ç–æ–≤** | `0 12 * * *` | –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 12:00 |
| **–ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** | `0 3 * * 0` | –ö–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 03:00 |

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º

–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏.

**–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∑–∞–¥–∞—á–∏:**
```javascript
const musicScheduler = require('./src/modules/music/music-scheduler');
await musicScheduler.runTask('update-playlists');
```

## –°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π

### –ê–Ω–∞–ª–∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è:
- üìä –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 90 –¥–Ω–µ–π)
- ‚ù§Ô∏è –õ–∞–π–∫–Ω—É—Ç—ã–µ —Ç—Ä–µ–∫–∏
- üé≠ –õ—é–±–∏–º—ã–µ –∂–∞–Ω—Ä—ã –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏
- ‚è∞ –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è (–≤—Ä–µ–º—è —Å—É—Ç–æ–∫)
- üÜï –û—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å –∫ –Ω–æ–≤–æ–º—É (diversity score)

### –ü—Ä–æ—Ñ–∏–ª—å –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç–∏

```javascript
{
  "openness": "high",        // high | medium | low
  "artistDiversity": 0.72,   // 0.0 - 1.0
  "newReleaseRatio": 0.35    // –¥–æ–ª—è –Ω–æ–≤–∏–Ω–æ–∫ –≤ –∏—Å—Ç–æ—Ä–∏–∏
}
```

### –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ (–µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)
- –ö–∞–∂–¥—ã–µ 7 –¥–Ω–µ–π (–µ—Å–ª–∏ —É—Å—Ç–∞—Ä–µ–ª)

## –ê–ª–≥–æ—Ä–∏—Ç–º—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤

### –ü–ª–µ–π–ª–∏—Å—Ç –¥–Ω—è (Daily)
```
70% - –õ—é–±–∏–º—ã–µ –∂–∞–Ω—Ä—ã
20% - –õ—é–±–∏–º—ã–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏
10% - –°–ª—É—á–∞–π–Ω—ã–µ —Ç—Ä–µ–∫–∏
```
–ò—Å–∫–ª—é—á–∞—é—Ç—Å—è —Ç—Ä–µ–∫–∏, –ø—Ä–æ—Å–ª—É—à–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π.

### –ü—Ä–µ–º—å–µ—Ä—ã (Premiere)
```
80% - –ù–æ–≤–∏–Ω–∫–∏ –∏–∑ –ª—é–±–∏–º—ã—Ö –∂–∞–Ω—Ä–æ–≤/–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
20% - –°–ª—É—á–∞–π–Ω—ã–µ –Ω–æ–≤–∏–Ω–∫–∏
```
–¢–æ–ª—å–∫–æ —Ç—Ä–µ–∫–∏ —Å —Ñ–ª–∞–≥–æ–º `features.isNew === true`.

### –¢–∞–π–Ω–∏–∫ (Stash)
```
60% - –ú–∞–ª–æ–ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç—Ä–µ–∫–∏ –ª—é–±–∏–º—ã—Ö –∂–∞–Ω—Ä–æ–≤ (playCount < 50)
40% - –¢—Ä–µ–∫–∏ –ø–æ—Ö–æ–∂–∏—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
```
–¢–æ–ª—å–∫–æ –Ω–µ—Å–ª—É—à–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∏.

### –ß–∞—Ä—Ç—ã (Charts)
```
70% - –¢–æ–ø –ø–æ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è–º
30% - –¢–æ–ø –ø–æ –ª–∞–π–∫–∞–º
```
–¢—Ä–µ–∫–∏ —Å —Ñ–ª–∞–≥–æ–º `features.isChart === true`.

## –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ç—Ä–µ–∫–æ–≤

### –ê–ª–≥–æ—Ä–∏—Ç–º

1. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–æ–∫:**
   - –£–¥–∞–ª–µ–Ω–∏–µ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤
   - –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ lowercase
   - –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤

2. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ:**
   - –ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞
   - –û—Å–Ω–æ–≤–Ω–æ–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å (–ø–µ—Ä–≤—ã–π –≤ —Å–ø–∏—Å–∫–µ)

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ:**
   ```sql
   WHERE LOWER(REGEXP_REPLACE(title, '[^A-Za-z0-9–ê-–Ø–∞-—è–Å—ë\s]', '', 'g')) = 'normalized_title'
   AND LOWER(artist) = 'normalized_artist'
   ```

### –ü—Ä–∏–º–µ—Ä

```javascript
// –≠—Ç–∏ —Ç—Ä–µ–∫–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏:
"–ë–∞—Å—Ç–∞ - –°–∞–Ω—Å–∞—Ä–∞ (2024)" === "–ë–∞—Å—Ç–∞ - –°–∞–Ω—Å–∞—Ä–∞"
"–°–∫—Ä–∏–ø—Ç–æ–Ω–∏—Ç, –†–∞–π–¥–∞ - –ü–æ–ª–æ–∂–µ–Ω–∏–µ" === "–°–∫—Ä–∏–ø—Ç–æ–Ω–∏—Ç - –ü–æ–ª–æ–∂–µ–Ω–∏–µ"
```

## –ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–æ–≤ —Ç—Ä–µ–∫–æ–≤

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏

- **premiere** - –ù–æ–≤–∏–Ω–∫–∏ (—Å–æ–¥–µ—Ä–∂–∞—Ç "2024", "2025", "–ø—Ä–µ–º—å–µ—Ä–∞", "–Ω–æ–≤–∏–Ω–∫–∞")
- **chart** - –ß–∞—Ä—Ç—ã (–∏–∑ —Ç–æ–ø–æ–≤—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü)
- **catalog** - –ö–∞—Ç–∞–ª–æ–≥ (–æ—Å—Ç–∞–ª—å–Ω—ã–µ)

### –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤ `features`

```json
{
  "category": "premiere",
  "isNew": true,
  "isChart": false,
  "importedAt": "2025-11-30T12:00:00Z"
}
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞

```bash
# –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
docker exec errorparty_backend node -e "
  const syncService = require('./src/modules/music/music-auto-sync.service');
  syncService.fullSync({ chartsLimit: 50, newReleasesLimit: 30 })
    .then(r => console.log('Done:', JSON.stringify(r, null, 2)));
"
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤

```bash
# –°–æ–∑–¥–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç –¥–Ω—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è #1
docker exec errorparty_backend node -e "
  const smartPlaylists = require('./src/modules/music/smart-playlists.service');
  smartPlaylists.generateDailyPlaylist(1)
    .then(r => console.log('Tracks:', r.tracks.length));
"
```

### –ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π

```bash
# –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è #1
docker exec errorparty_backend node -e "
  const preferences = require('./src/modules/music/user-preferences.service');
  preferences.buildUserProfile(1)
    .then(p => console.log('Profile:', JSON.stringify(p, null, 2)));
"
```

## –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü:

```bash
docker exec errorparty_backend node -e "
  const migration = require('./migrations/20251130-add-smart-playlists.js');
  const { sequelize } = require('./src/config/database');
  const { Sequelize } = require('sequelize');
  migration.up(sequelize.getQueryInterface(), Sequelize)
    .then(() => console.log('‚úÖ Migration complete'));
"
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

- üöÄ –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ `userId`, `type`, `expiresAt`
- üîÑ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ (expires —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞)
- üì¶ –ë–∞—Ç—á-–æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ
- ‚ö° –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ä–∞–∑ –≤ 7 –¥–Ω–µ–π
- –ü–ª–µ–π–ª–∏—Å—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏
- –ò–º–ø–æ—Ä—Ç –Ω–æ–≤–∏–Ω–æ–∫ –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤ (–Ω–µ –Ω–∞–≥—Ä—É–∂–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É)

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

```
üéµ === –ò–ú–ü–û–†–¢ –ò–ó –ß–ê–†–¢–û–í ===
üìä –ü–∞—Ä—Å–∏–Ω–≥ —á–∞—Ä—Ç–∞: Top 100
‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω: –¢—Ä–µ–∫ - –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å [premiere]
‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞: –¢—Ä–µ–∫ - –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å
üìà –ò—Ç–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: 45
```

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–ª–µ–π–ª–∏—Å—Ç—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è:

```sql
SELECT COUNT(*) FROM "ListeningHistory" WHERE "userId" = 1;
```

### –ü—Ä–æ–±–ª–µ–º–∞: –î—É–±–ª–∏–∫–∞—Ç—ã —Ç—Ä–µ–∫–æ–≤

**–†–µ—à–µ–Ω–∏–µ:** –ê–ª–≥–æ—Ä–∏—Ç–º –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ `music-auto-sync.service.js`:

```javascript
normalizeString(str) {
  return str.toLowerCase()
    .replace(/[^\w\s\u0400-\u04FF]/g, '')
    .replace(/\s+/g, ' ')
    .trim();
}
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:

```bash
docker logs errorparty_backend | grep "Music Scheduler"
```

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Spotify API –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- [ ] ML-–º–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –≤–∫—É—Å–æ–≤
- [ ] –ö–æ–ª–ª–∞–±–æ—Ä–∞—Ç–∏–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –ø–æ—Ö–æ–∂–∏–º–∏ –≤–∫—É—Å–∞–º–∏)
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ UI
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

---

**–°–æ–∑–¥–∞–Ω–æ:** 30 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–ê–≤—Ç–æ—Ä:** ErrorParty.ru Team
