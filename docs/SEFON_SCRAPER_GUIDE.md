# Sefon.pro Scraper ‚Äî –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

Puppeteer-—Å–∫—Ä–µ–π–ø–µ—Ä –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç—Ä–µ–∫–æ–≤ —Å —Å–∞–π—Ç–∞ **sefon.pro** –∏ –∏–º–ø–æ—Ä—Ç–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ API.

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
2. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
3. [–°–∫—Ä–µ–π–ø–∏–Ω–≥ —Ç—Ä–µ–∫–æ–≤](#—Å–∫—Ä–µ–π–ø–∏–Ω–≥-—Ç—Ä–µ–∫–æ–≤)
4. [–ò–º–ø–æ—Ä—Ç –≤ –±–∞–∑—É](#–∏–º–ø–æ—Ä—Ç-–≤-–±–∞–∑—É)
5. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
6. [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Node.js** 18+ (–ø—Ä–æ–≤–µ—Ä–∫–∞: `node -v`)
- **npm** –∏–ª–∏ **yarn**
- –î–æ—Å—Ç—É–ø –∫ **sefon.pro** (–±–µ–∑ –≥–µ–æ-–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```powershell
# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd "d:\–ú–û–ô –°–ê–ô–¢"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Puppeteer (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
npm install puppeteer

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
node -e "console.log(require('puppeteer').version())"
```

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–∫—Ä–µ–π–ø–∏–Ω–≥ –Ω–æ–≤–∏–Ω–æ–∫ (10 —Ç—Ä–µ–∫–æ–≤)

```powershell
node tools/sefon-scraper.js --url=/news/ --limit=10 --output=tracks.json
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** —Ñ–∞–π–ª `tracks.json` —Å 10 —Ç—Ä–µ–∫–∞–º–∏

### 2. –ò–º–ø–æ—Ä—Ç –≤ –±–∞–∑—É (dry-run)

```powershell
node tools/sefon-import.js --input=tracks.json --dry-run
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### 3. –†–µ–∞–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç

```powershell
node tools/sefon-import.js --input=tracks.json --api=http://localhost:3001/api
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** —Ç—Ä–µ–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –±–∞–∑—É —á–µ—Ä–µ–∑ `POST /api/music/tracks`

---

## üéµ –°–∫—Ä–µ–π–ø–∏–Ω–≥ —Ç—Ä–µ–∫–æ–≤

### –ö–æ–º–∞–Ω–¥–∞

```powershell
node tools/sefon-scraper.js [–æ–ø—Ü–∏–∏]
```

### –û–ø—Ü–∏–∏

| –û–ø—Ü–∏—è              | –û–ø–∏—Å–∞–Ω–∏–µ                                      | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é       |
|--------------------|-----------------------------------------------|--------------------|
| `--url=<path>`     | –ü—É—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è —Å–∫—Ä–µ–π–ø–∏–Ω–≥–∞                  | `/news/`           |
| `--limit=<—á–∏—Å–ª–æ>`  | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–∫–æ–≤                | `50`               |
| `--pages=<—á–∏—Å–ª–æ>`  | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –æ–±—Ö–æ–¥–∞                 | `1`                |
| `--output=<—Ñ–∞–π–ª>`  | –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è JSON (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω ‚Äî –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å) | `null` |
| `--no-headless`    | –ó–∞–ø—É—Å—Ç–∏—Ç—å –±—Ä–∞—É–∑–µ—Ä —Å –≤–∏–¥–∏–º—ã–º –æ–∫–Ω–æ–º             | `false`            |
| `--proxy=<url>`    | –ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä (http://ip:port –∏–ª–∏ socks5://) | `null`             |
| `--timeout=<–º—Å>`   | –¢–∞–π–º–∞—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã                     | `30000`            |

### –ü—Ä–∏–º–µ—Ä—ã

#### –°–∫—Ä–µ–π–ø–∏–Ω–≥ –Ω–æ–≤–∏–Ω–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)

```powershell
node tools/sefon-scraper.js --url=/news/ --limit=20 --output=news.json
```

#### –°–∫—Ä–µ–π–ø–∏–Ω–≥ –∂–∞–Ω—Ä–∞ "Pop" (3 —Å—Ç—Ä–∞–Ω–∏—Ü—ã)

```powershell
node tools/sefon-scraper.js --url=/genres/pop/ --pages=3 --limit=100 --output=pop.json
```

#### –°–∫—Ä–µ–π–ø–∏–Ω–≥ —Ç—Ä–µ–∫–æ–≤ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è

```powershell
# Eminem - 20 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤
node tools/sefon-scraper.js --url=/artist/1324-eminem/ --limit=20 --output=eminem.json

# Rihanna - –≤—Å–µ —Ç—Ä–µ–∫–∏ (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π)
node tools/sefon-scraper.js --url=/artist/694-rihanna/ --pages=5 --limit=100 --output=rihanna.json
```

#### –°–∫—Ä–µ–π–ø–∏–Ω–≥ —Ç–æ–ø–∞ (—Å –≤–∏–¥–∏–º—ã–º –±—Ä–∞—É–∑–µ—Ä–æ–º)

```powershell
node tools/sefon-scraper.js --url=/top/ --limit=50 --no-headless --output=top.json
```

#### –°–∫—Ä–µ–π–ø–∏–Ω–≥ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏

```powershell
node tools/sefon-scraper.js --url=/news/ --proxy=http://45.123.45.67:8080 --output=tracks.json
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON

```json
[
  {
    "mp3Id": "2550070",
    "artist": "Amaya Roma",
    "title": "–ö–∞—Ä–∞–æ–∫–µ",
    "duration": "02:54",
    "dateAdded": "12 —Å–µ–Ω—Ç—è–±—Ä—è 2025",
    "likes": 1015,
    "dislikes": 78,
    "streamUrl": "https://cdn3.sefon.pro/prev/...",
    "trackPageUrl": "https://sefon.pro/mp3/2550070-amaya-roma-karaoke/",
    "coverUrl": null,
    "source": "sefon.pro",
    "scrapedAt": "2025-12-04T12:34:56.789Z"
  }
]
```

### –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **JS-–¥–µ–∫–æ–¥–µ—Ä:** –°–∫—Ä–∏–ø—Ç –∂–¥—ë—Ç 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, —á—Ç–æ–±—ã JS-—Ñ—É–Ω–∫—Ü–∏—è `_0xfdef()` —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–ª–∞ `data-url` –≤ —Ä–µ–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏
2. **–ë–µ–∑ streamUrl:** –ï—Å–ª–∏ `streamUrl === null`, –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
   - –î–µ–∫–æ–¥–µ—Ä –Ω–µ —É—Å–ø–µ–ª –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è (—É–≤–µ–ª–∏—á—å—Ç–µ `waitForTimeout` –≤ –∫–æ–¥–µ)
   - –ò–∑–º–µ–Ω–∏–ª–∞—Å—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∞–π—Ç–∞
   - –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
3. **–ì–µ–æ-–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞:** –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ "–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –≤–∞—à–µ–π —Å—Ç—Ä–∞–Ω–µ" ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--proxy=`

---

## üì¶ –ò–º–ø–æ—Ä—Ç –≤ –±–∞–∑—É

### –ö–æ–º–∞–Ω–¥–∞

```powershell
node tools/sefon-import.js [–æ–ø—Ü–∏–∏]
```

### –û–ø—Ü–∏–∏

| –û–ø—Ü–∏—è                 | –û–ø–∏—Å–∞–Ω–∏–µ                                      | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é                      |
|-----------------------|-----------------------------------------------|-----------------------------------|
| `--input=<—Ñ–∞–π–ª>`      | –ü—É—Ç—å –∫ JSON —Å —Ç—Ä–µ–∫–∞–º–∏                         | `tracks.json`                     |
| `--api=<url>`         | –ë–∞–∑–æ–≤—ã–π URL API                               | `https://errorparty.ru/api`       |
| `--endpoint=<path>`   | Endpoint –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–µ–∫–æ–≤                  | `/music/tracks`                   |
| `--dry-run`           | –°—É—Ö–æ–π –ø—Ä–æ–≥–æ–Ω (–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã)          | `false`                           |
| `--concurrent=<—á–∏—Å–ª–æ>`| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤             | `3`                               |
| `--delay=<–º—Å>`        | –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏                        | `500`                             |
| `--token=<jwt>`       | JWT —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)        | `null`                            |

### –ü—Ä–∏–º–µ—Ä—ã

#### –¢–µ—Å—Ç–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç (dry-run)

```powershell
node tools/sefon-import.js --input=news.json --dry-run
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å –±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

#### –õ–æ–∫–∞–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç (dev-—Å–µ—Ä–≤–µ—Ä)

```powershell
node tools/sefon-import.js --input=tracks.json --api=http://localhost:3001/api
```

#### Production –∏–º–ø–æ—Ä—Ç

```powershell
node tools/sefon-import.js --input=pop.json --api=https://errorparty.ru/api --concurrent=5
```

#### –ò–º–ø–æ—Ä—Ç —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π

```powershell
node tools/sefon-import.js --input=tracks.json --token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### API –∑–∞–ø—Ä–æ—Å

–°–∫—Ä–∏–ø—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `POST /api/music/tracks` —Å —Ç–µ–ª–æ–º:

```json
{
  "title": "–ö–∞—Ä–∞–æ–∫–µ",
  "artist": "Amaya Roma",
  "duration": 174,
  "streamUrl": "https://cdn3.sefon.pro/prev/...",
  "coverUrl": null,
  "source": "sefon.pro",
  "externalId": "2550070",
  "metadata": {
    "likes": 1015,
    "dislikes": 78,
    "dateAdded": "12 —Å–µ–Ω—Ç—è–±—Ä—è 2025",
    "trackPageUrl": "https://sefon.pro/mp3/2550070-amaya-roma-karaoke/",
    "scrapedAt": "2025-12-04T12:34:56.789Z"
  }
}
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è

- –¢—Ä–µ–∫–∏ –±–µ–∑ `streamUrl` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è
- Duration –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –∏–∑ `MM:SS` –≤ —Å–µ–∫—É–Ω–¥—ã
- API –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å—Ç–∞—Ç—É—Å `200-299` –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: —Å–∫—Ä–µ–π–ø–∏–Ω–≥ ‚Üí –∏–º–ø–æ—Ä—Ç

```powershell
# 1. –°–∫—Ä–µ–π–ø–∏–º 50 –Ω–æ–≤–∏–Ω–æ–∫
node tools/sefon-scraper.js --url=/news/ --limit=50 --output=news.json

# 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ
node tools/sefon-import.js --input=news.json --dry-run

# 3. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É
node tools/sefon-import.js --input=news.json --api=http://localhost:3001/api
```

### –°–∫—Ä–µ–π–ø–∏–Ω–≥ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∂–∞–Ω—Ä–æ–≤

```powershell
# Pop
node tools/sefon-scraper.js --url=/genres/pop/ --pages=2 --output=pop.json

# Rock
node tools/sefon-scraper.js --url=/genres/rock/ --pages=2 --output=rock.json

# Rap
node tools/sefon-scraper.js --url=/genres/rap/ --pages=2 --output=rap.json

# –ò–º–ø–æ—Ä—Ç –≤—Å–µ—Ö
node tools/sefon-import.js --input=pop.json
node tools/sefon-import.js --input=rock.json
node tools/sefon-import.js --input=rap.json
```

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (PowerShell —Å–∫—Ä–∏–ø—Ç)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `update-music.ps1`:

```powershell
#!/usr/bin/env pwsh

Write-Host "üéµ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º—É–∑—ã–∫–∏ –∏–∑ sefon.pro" -ForegroundColor Cyan

# –°–∫—Ä–µ–π–ø–∏–Ω–≥
Write-Host "`nüì• –°–∫—Ä–µ–π–ø–∏–Ω–≥ –Ω–æ–≤–∏–Ω–æ–∫..." -ForegroundColor Yellow
node tools/sefon-scraper.js --url=/news/ --limit=30 --output=temp/news.json

Write-Host "`nüì• –°–∫—Ä–µ–π–ø–∏–Ω–≥ —Ç–æ–ø–∞..." -ForegroundColor Yellow
node tools/sefon-scraper.js --url=/top/ --limit=30 --output=temp/top.json

# –ò–º–ø–æ—Ä—Ç
Write-Host "`nüì¶ –ò–º–ø–æ—Ä—Ç –Ω–æ–≤–∏–Ω–æ–∫..." -ForegroundColor Green
node tools/sefon-import.js --input=temp/news.json --api=http://localhost:3001/api

Write-Host "`nüì¶ –ò–º–ø–æ—Ä—Ç —Ç–æ–ø–∞..." -ForegroundColor Green
node tools/sefon-import.js --input=temp/top.json --api=http://localhost:3001/api

Write-Host "`n‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!" -ForegroundColor Green
```

–ó–∞–ø—É—Å–∫:

```powershell
.\update-music.ps1
```

---

---

## üé§ –°–∫—Ä–µ–π–ø–∏–Ω–≥ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –∏ –ø–æ–¥–±–æ—Ä–æ–∫

### –ù–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: `sefon-collections-scraper.js`

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–µ–π–ø–µ—Ä –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è **–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π** (`/artists/`) –∏ **–ø–æ–¥–±–æ—Ä–æ–∫** (`/collections/`).

#### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π

```powershell
node tools/sefon-collections-scraper.js --url=/artists/ --output=artists.json
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** JSON —Å 90 –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º–∏ (–∏–º—è, URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã, —Ñ–æ—Ç–æ):

```json
{
  "name": "MiyaGi",
  "url": "https://sefon.pro/artist/161-miyagi/",
  "photoUrl": "https://sefon.pro/img/artist_photos/miyagi.jpg",
  "source": "sefon.pro",
  "scrapedAt": "2025-12-04T07:20:51.513Z"
}
```

#### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–¥–±–æ—Ä–æ–∫

```powershell
node tools/sefon-collections-scraper.js --url=/collections/ --output=collections.json
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** JSON —Å –ø–æ–¥–±–æ—Ä–∫–∞–º–∏ (–Ω–∞–∑–≤–∞–Ω–∏–µ, URL):

```json
{
  "title": "–ù–æ–≤—ã–π –≥–æ–¥",
  "url": "https://sefon.pro/collections/prazdniki/168-novyj-god/",
  "imageUrl": null,
  "source": "sefon.pro",
  "scrapedAt": "2025-12-04T07:22:21.974Z"
}
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–¥–±–æ—Ä–æ–∫

–ü–æ—Å–ª–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–æ–¥–±–æ—Ä–æ–∫ –º–æ–∂–Ω–æ —Å–∫—Ä–µ–π–ø–∏—Ç—å —Ç—Ä–µ–∫–∏ –∏–∑ –∫–∞–∂–¥–æ–π:

```powershell
# –ò–∑–≤–ª–µ–∫–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–¥–±–æ—Ä–æ–∫
node tools/sefon-collections-scraper.js --url=/collections/ --output=collections.json

# –°–∫—Ä–µ–π–ø–∏–º —Ç—Ä–µ–∫–∏ –∏–∑ –ø–æ–¥–±–æ—Ä–∫–∏ "–ù–æ–≤—ã–π –≥–æ–¥"
node tools/sefon-scraper.js --url=/collections/prazdniki/168-novyj-god/ --limit=50 --output=new-year.json
```

---

## üîç –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∫—Ä–µ–π–ø–∏–Ω–≥

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ HTML –Ω–∞ sefon.pro

–°–∫—Ä–µ–π–ø–µ—Ä –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç—Ä–µ–∫–∏ –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ `.mp3[data-mp3_id]`:

```html
<div class="mp3" data-mp3_id="2615572">
  <div class="artist_name"><a>What So Not</a></div>
  <div class="song_name"><a href="/mp3/2615572-...">Tragic</a></div>
  <div class="duration"><span class="value">04:34</span></div>
  <div class="btns">
    <span data-url="https://cdn9.sefon.pro/prev/.../track.mp3" data-key="...">
      <!-- –ö–Ω–æ–ø–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è -->
    </span>
  </div>
</div>
```

### –ß—Ç–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è

- `mp3Id` ‚Äî –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–∞ `data-mp3_id`
- `artist`, `title` ‚Äî –∏–∑ —Ç–µ–∫—Å—Ç–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- `duration` ‚Äî –∏–∑ `.duration .value`
- `streamUrl` ‚Äî –∏–∑ `span[data-url]` **(–ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ CDN)**
- `trackPageUrl` ‚Äî –∏–∑ `.song_name a[href]`

### –í–∞–∂–Ω–æ

‚ö†Ô∏è **–°—Å—ã–ª–∫–∏ –Ω–∞ —Ç—Ä–µ–∫–∏ –ù–ï –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `<a>` —ç–ª–µ–º–µ–Ω—Ç–∞—Ö!**

–†–µ–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
```html
<span data-url="https://cdn9.sefon.pro/prev/.../track.mp3">
```

–°–∫—Ä–µ–π–ø–µ—Ä –∏–∑–≤–ª–µ–∫–∞–µ—Ç URL –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–∞ `data-url`, –∞ –Ω–µ –∏–∑ `href`.

---

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: "–°–∞–π—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –≤ –≤–∞—à–µ–π —Å—Ç—Ä–∞–Ω–µ"

**–†–µ—à–µ–Ω–∏–µ:**

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ VPN/–ø—Ä–æ–∫—Å–∏:
   ```powershell
   node tools/sefon-scraper.js --proxy=http://your-proxy:8080 --url=/news/
   ```

2. –ò–ª–∏ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç —Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ (–≥–¥–µ —Å–∞–π—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è)

### –ü—Ä–æ–±–ª–µ–º–∞: –¢—Ä–µ–∫–∏ –±–µ–∑ `streamUrl`

**–ü—Ä–∏—á–∏–Ω—ã:**

1. JS-–¥–µ–∫–æ–¥–µ—Ä –Ω–µ —É—Å–ø–µ–ª –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è

   **–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á—å—Ç–µ –∑–∞–¥–µ—Ä–∂–∫—É –≤ `sefon-scraper.js` (—Å—Ç—Ä–æ–∫–∞ 146):
   ```javascript
   await page.waitForTimeout(3000); // –ë—ã–ª–æ 2000
   ```

2. –ò–∑–º–µ–Ω–∏–ª–∞—Å—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∞–π—Ç–∞

   **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `extractTracksFromPage()`

3. –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

   **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (cookies/session) –≤ —Å–∫—Ä–∏–ø—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: "Failed to launch Chrome"

**–†–µ—à–µ–Ω–∏–µ:**

```powershell
# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ Puppeteer
npm uninstall puppeteer
npm install puppeteer

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–π Chrome
npm install puppeteer-core
# –ò —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ Chrome –≤ –∫–æ–¥–µ
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ò–º–ø–æ—Ä—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404/500

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**

1. API –¥–æ—Å—Ç—É–ø–µ–Ω:
   ```powershell
   curl http://localhost:3001/api/music/tracks
   ```

2. Endpoint –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ `music.routes.js`)

3. –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω:
   ```powershell
   docker ps | Select-String "errorparty_backend"
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**

1. –£–≤–µ–ª–∏—á—å—Ç–µ `--concurrent`:
   ```powershell
   node tools/sefon-import.js --concurrent=10
   ```

2. –£–º–µ–Ω—å—à–∏—Ç–µ `--delay`:
   ```powershell
   node tools/sefon-import.js --delay=200
   ```

3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ headless —Ä–µ–∂–∏–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á—ë–Ω)

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –°–∫—Ä–µ–π–ø–∏–Ω–≥

- **–°–∫–æ—Ä–æ—Å—Ç—å:** ~10-15 —Ç—Ä–µ–∫–æ–≤/—Å–µ–∫—É–Ω–¥—É (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)
- **–ü–∞–º—è—Ç—å:** ~200-300 MB (Chromium + Node.js)
- **CPU:** –°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞ (~20-30%)

### –ò–º–ø–æ—Ä—Ç

- **–°–∫–æ—Ä–æ—Å—Ç—å:** ~3-10 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫—É–Ω–¥—É (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç `--concurrent`)
- **–ü–∞–º—è—Ç—å:** ~50 MB
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
  - –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ API: `--concurrent=10 --delay=100`
  - –î–ª—è production API: `--concurrent=3 --delay=500` (—á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å)

---

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –í–∞–∂–Ω–æ

- ‚ùå –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `tracks.json` —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤ Git
- ‚ùå –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ JWT —Ç–æ–∫–µ–Ω—ã –≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.gitignore`:
  ```
  tools/tracks*.json
  tools/temp/
  ```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. –°–æ–∑–¥–∞–π—Ç–µ `.env` –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤:
   ```
   SEFON_PROXY=http://proxy:8080
   API_TOKEN=your-jwt-token
   ```

2. –ß–∏—Ç–∞–π—Ç–µ –∏–∑ `.env` –≤ —Å–∫—Ä–∏–ø—Ç–µ:
   ```javascript
   require('dotenv').config();
   const proxy = process.env.SEFON_PROXY;
   ```

---

## üìù –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### 1. `sefon-scraper.js` ‚Äî –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–µ–π–ø–µ—Ä —Ç—Ä–µ–∫–æ–≤

–ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç—Ä–µ–∫–∏ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü `/news/`, `/genres/`, `/top/`, `/collections/...`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```powershell
node tools/sefon-scraper.js --url=/news/ --limit=50 --output=tracks.json
```

### 2. `sefon-collections-scraper.js` ‚Äî –°–∫—Ä–µ–π–ø–µ—Ä –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –∏ –ø–æ–¥–±–æ—Ä–æ–∫

–ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π (`/artists/`) –∏ –ø–æ–¥–±–æ—Ä–æ–∫ (`/collections/`)

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```powershell
# –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ (90 –∑–∞–ø–∏—Å–µ–π)
node tools/sefon-collections-scraper.js --url=/artists/ --output=artists.json

# –ü–æ–¥–±–æ—Ä–∫–∏ (~48 –∑–∞–ø–∏—Å–µ–π)
node tools/sefon-collections-scraper.js --url=/collections/ --output=collections.json
```

### 3. `sefon-import.js` ‚Äî –ò–º–ø–æ—Ä—Ç—ë—Ä —Ç—Ä–µ–∫–æ–≤ –≤ –ë–î

–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–µ–∫–∏ —á–µ—Ä–µ–∑ REST API –≤ –≤–∞—à—É –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```powershell
node tools/sefon-import.js --input=tracks.json --api=http://localhost:3001/api
```

### 4. `scrape-all-collections.ps1` ‚Äî –ú–∞—Å—Å–æ–≤—ã–π —Å–∫—Ä–µ–π–ø–∏–Ω–≥ –ø–æ–¥–±–æ—Ä–æ–∫

PowerShell —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–∫—Ä–µ–π–ø–∏–Ω–≥–∞ –≤—Å–µ—Ö –ø–æ–¥–±–æ—Ä–æ–∫

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```powershell
.\tools\scrape-all-collections.ps1
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–¥–±–æ—Ä–æ–∫ (~48 —à—Ç—É–∫)
2. –°–∫—Ä–µ–π–ø–∏—Ç –ø–æ 30 —Ç—Ä–µ–∫–æ–≤ –∏–∑ –∫–∞–∂–¥–æ–π
3. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤ –ë–î (dry-run –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
4. –í—ã–≤–æ–¥–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

### 5. `scrape-all-artists.ps1` ‚Äî –ú–∞—Å—Å–æ–≤—ã–π —Å–∫—Ä–µ–π–ø–∏–Ω–≥ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π

PowerShell —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–∫—Ä–µ–π–ø–∏–Ω–≥–∞ —Ç—Ä–µ–∫–æ–≤ –≤—Å–µ—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```powershell
.\tools\scrape-all-artists.ps1
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π (90 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö)
2. –°–∫—Ä–µ–π–ø–∏—Ç –ø–æ 20 —Ç—Ä–µ–∫–æ–≤ –æ—Ç –∫–∞–∂–¥–æ–≥–æ
3. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤ –ë–î (dry-run –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
4. –í—ã–≤–æ–¥–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ~1800 —Ç—Ä–µ–∫–æ–≤ (90 –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π √ó 20 —Ç—Ä–µ–∫–æ–≤)

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–∫—Ä–µ–π–ø–µ—Ä –ª–æ–∫–∞–ª—å–Ω–æ
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º–ø–æ—Ä—Ç –≤ dev-–±–∞–∑—É
3. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `sefon-collections-scraper.js` –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π/–ø–æ–¥–±–æ—Ä–æ–∫
4. ‚è≥ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é (cron/Task Scheduler)
5. ‚è≥ –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ `externalId`)
6. ‚è≥ –†–∞—Å—à–∏—Ä—å—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –æ–±–ª–æ–∂–µ–∫ —Ç—Ä–µ–∫–æ–≤

---

## ‚ùì –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å `--no-headless` —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –±—Ä–∞—É–∑–µ—Ä
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--dry-run` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏–º–ø–æ—Ä—Ç–∞
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å sefon.pro –≤ –±—Ä–∞—É–∑–µ—Ä–µ

---

**–ì–æ—Ç–æ–≤–æ! üéâ**

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–∫–∏ —Å sefon.pro –≤ –≤–∞—à—É –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.
