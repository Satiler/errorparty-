# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–æ–π

## –û–ø–∏—Å–∞–Ω–∏–µ

–ú–æ–¥—É–ª—å –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç—Ä–µ–∫–æ–≤ –≤ –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–µ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö. –ü–æ—Å–∫–æ–ª—å–∫—É –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∞ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∞—É–¥–∏–æ—Ñ–∞–π–ª—ã –±–µ–∑ –ø–æ–¥–ø–∏—Å–∫–∏, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—â–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–µ –≤–µ—Ä—Å–∏–∏ –≤ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö (Jamendo, –ª–æ–∫–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞).

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üîç –ü–æ–∏—Å–∫
- –ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–æ–≤ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é/–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é
- –ü–æ–∏—Å–∫ –∞–ª—å–±–æ–º–æ–≤
- –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–µ–∫–µ
- –ü–∞–∫–µ—Ç–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –∑–∞–ø—Ä–æ—Å–∞–º

### üéµ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã—Ö –≤–µ—Ä—Å–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Ç—Ä–µ–∫–æ–≤ –≤ Jamendo
- –û—Ü–µ–Ω–∫–∞ –ø–æ—Ö–æ–∂–µ—Å—Ç–∏ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤

### üìä –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- –ò–º–ø–æ—Ä—Ç –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–µ–∫–µ
- –û–±–ª–æ–∂–∫–∏ –∞–ª—å–±–æ–º–æ–≤ (–≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ)
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∂–∞–Ω—Ä–∞—Ö, –≥–æ–¥–µ –≤—ã–ø—É—Å–∫–∞
- –°—Å—ã–ª–∫–∏ –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫—É

### üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç—Ä–µ–∫–∏
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω)

## API Endpoints

### –ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–æ–≤
```http
GET /api/music/yandex/search?q=query&limit=20
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `q` - –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `limit` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 20)

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "count": 10,
  "tracks": [
    {
      "id": "123456",
      "title": "–ì—Ä—É–ø–ø–∞ –ö—Ä–æ–≤–∏",
      "artist": "–ö–∏–Ω–æ",
      "album": "–ì—Ä—É–ø–ø–∞ –ö—Ä–æ–≤–∏",
      "duration": 268,
      "coverUri": "https://avatars.yandex.net/get-music-content/...",
      "year": 1988,
      "genre": "Rock",
      "yandexUrl": "https://music.yandex.ru/album/123/track/456"
    }
  ]
}
```

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–µ–∫–µ
```http
GET /api/music/yandex/tracks/:trackId
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "track": {
    "id": "123456",
    "title": "–ì—Ä—É–ø–ø–∞ –ö—Ä–æ–≤–∏",
    "artist": "–ö–∏–Ω–æ",
    "explicit": false,
    "available": true,
    "lyricsAvailable": true,
    ...
  }
}
```

### –ü–æ–∏—Å–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ–π –≤–µ—Ä—Å–∏–∏
```http
POST /api/music/yandex/tracks/:trackId/find-playable
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "yandexTrack": { ... },
  "playable": {
    "source": "jamendo",
    "track": {
      "artist": "Similar Artist",
      "title": "Similar Track",
      "url": "https://audio.jamendo.com/..."
    },
    "similarity": 85
  }
}
```

### –ò–º–ø–æ—Ä—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
```http
POST /api/music/yandex/tracks/:trackId/import
Authorization: Bearer <token>
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "track": {
    "id": 123,
    "title": "–ì—Ä—É–ø–ø–∞ –ö—Ä–æ–≤–∏",
    "externalSource": "yandex-music",
    ...
  },
  "playable": { ... },
  "message": "Track imported with playable version found"
}
```

### –ü–æ–∏—Å–∫ –∞–ª—å–±–æ–º–æ–≤
```http
GET /api/music/yandex/albums/search?q=query&limit=20
```

### –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç—Ä–µ–∫–∏
```http
GET /api/music/yandex/popular?limit=20
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
```http
GET /api/music/yandex/recommendations?limit=20
```

**Body (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
```json
{
  "token": "OAuth_token_here"
}
```

### –ü–∞–∫–µ—Ç–Ω—ã–π –ø–æ–∏—Å–∫
```http
POST /api/music/yandex/batch-search
Authorization: Bearer <token>
```

**Body:**
```json
{
  "queries": ["–ö–∏–Ω–æ", "–ê–∫–≤–∞—Ä–∏—É–º", "–î–î–¢"],
  "limit": 5
}
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–π –ø–æ–∏—Å–∫
```javascript
// –ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–æ–≤
const response = await fetch('/api/music/yandex/search?q=–ö–∏–Ω–æ –ì—Ä—É–ø–ø–∞ –ö—Ä–æ–≤–∏');
const data = await response.json();

// –ù–∞–π—Ç–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—É—é –≤–µ—Ä—Å–∏—é
const playable = await fetch(
  `/api/music/yandex/tracks/${data.tracks[0].id}/find-playable`,
  { method: 'POST' }
);
```

### –ò–º–ø–æ—Ä—Ç –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
```javascript
// 1. –ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–∞
const searchRes = await fetch('/api/music/yandex/search?q=–ë–∞—Å—Ç–∞ –°–∞–Ω—Å–∞—Ä–∞');
const { tracks } = await searchRes.json();

// 2. –ò–º–ø–æ—Ä—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
const importRes = await fetch(
  `/api/music/yandex/tracks/${tracks[0].id}/import`,
  {
    method: 'POST',
    headers: { 'Authorization': 'Bearer ' + token }
  }
);
const { track, playable } = await importRes.json();

// 3. –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
if (playable && playable.source === 'jamendo') {
  audio.src = playable.track.url;
  audio.play();
}
```

### –ü–∞–∫–µ—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
```javascript
const response = await fetch('/api/music/yandex/batch-search', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer ' + token,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    queries: ['–ö–∏–Ω–æ', '–ê–∫–≤–∞—Ä–∏—É–º', '–î–î–¢', '–ù–∞—É—Ç–∏–ª—É—Å –ü–æ–º–ø–∏–ª–∏—É—Å'],
    limit: 3
  })
});

const { results } = await response.json();
// results —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç—Ä–µ–∫–∏ —Å –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∏ –∏ –∏—Ö –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–µ –≤–µ—Ä—Å–∏–∏
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:

```bash
node test-yandex-music.js
```

–¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç:
- ‚úÖ –ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–æ–≤
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–µ–∫–µ
- ‚úÖ –ü–æ–∏—Å–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã—Ö –≤–µ—Ä—Å–∏–π
- ‚úÖ –ü–æ–∏—Å–∫ –∞–ª—å–±–æ–º–æ–≤
- ‚úÖ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç—Ä–µ–∫–∏

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, –ª–∏—á–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞) —Ç—Ä–µ–±—É—é—Ç OAuth —Ç–æ–∫–µ–Ω –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∏
2. **–ü—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏**: –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∞ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ MP3 –±–µ–∑ –ø–æ–¥–ø–∏—Å–∫–∏
3. **CORS**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±—Ö–æ–¥–∞ CORS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
4. **Rate limiting**: –Ø–Ω–¥–µ–∫—Å –º–æ–∂–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤

## –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã—Ö –≤–µ—Ä—Å–∏–π

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î**: –ò—â–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é –∏ –Ω–∞–∑–≤–∞–Ω–∏—é
2. **–ü–æ–∏—Å–∫ –≤ Jamendo**: –ò—â–µ–º –ø–æ—Ö–æ–∂–∏–µ —Ç—Ä–µ–∫–∏ —Å –æ—Ç–∫—Ä—ã—Ç–æ–π –ª–∏—Ü–µ–Ω–∑–∏–µ–π
3. **–û—Ü–µ–Ω–∫–∞ –ø–æ—Ö–æ–∂–µ—Å—Ç–∏**: –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (0-100%)
4. **–í–æ–∑–≤—Ä–∞—Ç –ª—É—á—à–µ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è**: –¢—Ä–µ–∫ —Å –Ω–∞–∏–±–æ–ª—å—à–µ–π –ø–æ—Ö–æ–∂–µ—Å—Ç—å—é

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ø–ª–µ–µ—Ä —Å –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–æ–π
```javascript
// 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—â–µ—Ç —Ç—Ä–µ–∫
const query = '–ë–∞—Å—Ç–∞ –°–∞–Ω—Å–∞—Ä–∞';
const yandexResults = await searchYandexMusic(query);

// 2. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –æ–±–ª–æ–∂–∫–∞–º–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
displayResults(yandexResults);

// 3. –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ç—Ä–µ–∫ - –∏—â–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—É—é –≤–µ—Ä—Å–∏—é
const playable = await findPlayableVersion(selectedTrack.id);

// 4. –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º
if (playable) {
  playTrack(playable);
} else {
  showMessage('–¢—Ä–µ–∫ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–µ');
  openYandexMusic(selectedTrack.yandexUrl);
}
```

### –ò–º–ø–æ—Ä—Ç –ø–ª–µ–π–ª–∏—Å—Ç–∞
```javascript
const playlist = [
  '–ö–∏–Ω–æ - –ì—Ä—É–ø–ø–∞ –ö—Ä–æ–≤–∏',
  '–ê–∫–≤–∞—Ä–∏—É–º - –ì–æ—Ä–æ–¥',
  '–î–î–¢ - –≠—Ç–æ –≤—Å—ë'
];

const results = await batchSearch(playlist);

// –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∏
for (const result of results) {
  if (result.playable) {
    await importTrack(result.yandexTrack.id);
  }
}
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ API
- **–Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∞ API**: `https://api.music.yandex.net:443`
- **CORS Proxy**: `https://yandex-music-cors-proxy.onrender.com`
- **Jamendo API**: –î–ª—è –ø–æ–∏—Å–∫–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
–¢—Ä–µ–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å:
- `externalSource: 'yandex-music'`
- `externalId: 'yandex_<trackId>'`
- `sourceType: 'external'`
- `allowDownload: false`

### –û—Ü–µ–Ω–∫–∞ –ø–æ—Ö–æ–∂–µ—Å—Ç–∏
```javascript
similarity = titleMatch (0-50%) + artistMatch (0-50%)
```

## Roadmap

- [ ] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ OAuth –Ø–Ω–¥–µ–∫—Å
- [ ] –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–∏—á–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ (YouTube Music, Spotify)
- [ ] –£–ª—É—á—à–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ –ø–æ—Ö–æ–∂–∏—Ö —Ç—Ä–µ–∫–æ–≤
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–¥–∫–∞—Å—Ç–æ–≤ –∏ –∞—É–¥–∏–æ–∫–Ω–∏–≥

## –õ–∏—Ü–µ–Ω–∑–∏—è

–ú–æ–¥—É–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞ —Å–≤–æ–π —Ä–∏—Å–∫.
